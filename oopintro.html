<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>oopintro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="F# Functional IO Library"/>
    <meta name="author" content="Phil Curzon"/>

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link type="text/css" rel="stylesheet" href="/NovelIO/content/style.css" />
    <script type="text/javascript" src="/NovelIO/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="http://github.com/TheInnerLight/NovelIO">github page</a></li>
        </ul>
        <h3 class="muted"><a href="/NovelIO/index.html">NovelIO</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h2><a name="Introduction-from-an-Object-Oriented-Perspective" class="anchor" href="#Introduction-from-an-Object-Oriented-Perspective">Introduction from an Object-Oriented Perspective</a></h2>
<p>For those coming from an OOP background, the purpose of purely functional I/O might not seem immediately apparent.  Two principles that might be familiar to developers more generally are:</p>
<ul>
<li>Commandâ€“query separation</li>
<li>The Principle of least astonishment</li>
</ul>
<h2><a name="Command-Query-Seperation" class="anchor" href="#Command-Query-Seperation">Command-Query Seperation</a></h2>
<p>Command-query seperation (CQS) is an imperative programming principle that says that each method should either be a Command or a Query.</p>
<ul>
<li>Commands perform side effects but return no data, in F# terms they return <code>unit</code>.</li>
<li>Queries return data to the caller, they must be referentially transparent (i.e. possess no side-effects).</li>
</ul>
<pre class="fssnip highlighted"><code lang="fsharp">    <span class="k">type</span> <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="t">ExampleClass</span> <span class="o">=</span>
        <span class="c">/// Performs the side effect of writing text to the screen</span>
        <span class="k">member</span> <span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 5)" onmouseover="showTip(event, 'fs5', 5)" class="f">Command</span>() <span class="o">=</span> <span onmouseout="hideTip(event, 'fs6', 6)" onmouseover="showTip(event, 'fs6', 6)" class="f">printfn</span> <span class="s">&quot;Hello World!&quot;</span>
        <span class="c">/// Pure function that raises x to the power of 3</span>
        <span class="k">member</span> <span onmouseout="hideTip(event, 'fs4', 7)" onmouseover="showTip(event, 'fs4', 7)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 8)" onmouseover="showTip(event, 'fs7', 8)" class="f">Query</span> <span onmouseout="hideTip(event, 'fs8', 9)" onmouseover="showTip(event, 'fs8', 9)" class="i">x</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs9', 10)" onmouseover="showTip(event, 'fs9', 10)" class="f">pown</span> <span onmouseout="hideTip(event, 'fs8', 11)" onmouseover="showTip(event, 'fs8', 11)" class="i">x</span> <span class="n">3</span> 
</code></pre>
<h2><a name="The-Principle-of-Least-Astonishment" class="anchor" href="#The-Principle-of-Least-Astonishment">The Principle of Least Astonishment</a></h2>
<p>The principle of least astonishment is more nebulously designed but it effectively states that the design of your software API should match the mental model of its user.  Design decisions that take people by surprise are damaging because it will invariably result in them using the software incorrectly.</p>
<p>Command-query seperation helps to avoid astonishment on the part of the developer.  They can see that functions which return <code>unit</code> do some side effect.</p>
<p>The effect of CQS on queries is even more significant.  If we don't follow the principle, there is really no way for our API users to see whether or not a function with a return value does some side-effect before returning the value or if the function is referentially transparent by contrast, following the principle means our API consumer knows that queries do not produce side-effects.</p>
<h2><a name="A-Better-Alternative" class="anchor" href="#A-Better-Alternative">A Better Alternative</a></h2>
<p>While command-query seperation is a way of solving the problem, can we offer a better one?</p>
<h3><a name="Introducing" class="anchor" href="#Introducing">Introducing <code>IO&lt;'a&gt;</code></a></h3>
<p>Imagine two possible queries:</p>
<ol>
<li>cube : A pure function that raises x to the power of 3</li>
</ol>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs10', 12)" onmouseover="showTip(event, 'fs10', 12)" class="f">cube</span> <span onmouseout="hideTip(event, 'fs8', 13)" onmouseover="showTip(event, 'fs8', 13)" class="i">x</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs9', 14)" onmouseover="showTip(event, 'fs9', 14)" class="f">pown</span> <span onmouseout="hideTip(event, 'fs8', 15)" onmouseover="showTip(event, 'fs8', 15)" class="i">x</span> <span class="n">3</span>
</code></pre>
<ol>
<li>readIntFromFile : A function that gets an int from a file.</li>
</ol>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 16)" onmouseover="showTip(event, 'fs1', 16)" class="i">NovelFS</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs2', 17)" onmouseover="showTip(event, 'fs2', 17)" class="i">NovelIO</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs11', 18)" onmouseover="showTip(event, 'fs11', 18)" class="i">BinaryParser</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 19)" onmouseover="showTip(event, 'fs12', 19)" class="f">readIntFromFile</span> <span onmouseout="hideTip(event, 'fs13', 20)" onmouseover="showTip(event, 'fs13', 20)" class="i">file</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs14', 21)" onmouseover="showTip(event, 'fs14', 21)" class="i">io</span> {
        <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs15', 22)" onmouseover="showTip(event, 'fs15', 22)" class="i">bytes</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs16', 23)" onmouseover="showTip(event, 'fs16', 23)" class="t">File</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs17', 24)" onmouseover="showTip(event, 'fs17', 24)" class="f">readAllBytes</span> <span onmouseout="hideTip(event, 'fs13', 25)" onmouseover="showTip(event, 'fs13', 25)" class="i">file</span>
        <span class="k">match</span> <span onmouseout="hideTip(event, 'fs18', 26)" onmouseover="showTip(event, 'fs18', 26)" class="t">BinaryParser</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs19', 27)" onmouseover="showTip(event, 'fs19', 27)" class="f">run</span> <span onmouseout="hideTip(event, 'fs15', 28)" onmouseover="showTip(event, 'fs15', 28)" class="i">bytes</span> (<span onmouseout="hideTip(event, 'fs18', 29)" onmouseover="showTip(event, 'fs18', 29)" class="t">BinaryParser</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 30)" onmouseover="showTip(event, 'fs20', 30)" class="i">parseInt32</span>) <span class="k">with</span>
        |<span onmouseout="hideTip(event, 'fs21', 31)" onmouseover="showTip(event, 'fs21', 31)" class="p">ParseSuccess</span> <span onmouseout="hideTip(event, 'fs22', 32)" onmouseover="showTip(event, 'fs22', 32)" class="i">flt</span> <span class="k">-&gt;</span> <span class="k">return</span> <span onmouseout="hideTip(event, 'fs23', 33)" onmouseover="showTip(event, 'fs23', 33)" class="p">Some</span> <span onmouseout="hideTip(event, 'fs22', 34)" onmouseover="showTip(event, 'fs22', 34)" class="i">flt</span>
        |_ <span class="k">-&gt;</span> <span class="k">return</span> <span onmouseout="hideTip(event, 'fs24', 35)" onmouseover="showTip(event, 'fs24', 35)" class="p">None</span>
    }
</code></pre>
<p>It is worth looking at the type signatures of these functions.</p>
<p><code>cube</code> simply has the type signature: <code>int -&gt; int</code></p>
<p><code>readFloatFromFile</code> file, by contrast, has type signature: <code>Filename -&gt; IO&lt;int option&gt;</code></p>
<p>We can now quite clearly see that, even were it not obvious from the name, the second function is different.  The fact that it needs to interact with the file system is now encoded in the type signature.</p>
<p>Hopefully this shows how we can use purely functional IO to make our coder richer but with less risk of astonishing our API users.</p>

<div class="tip" id="fs1">namespace NovelFS</div>
<div class="tip" id="fs2">namespace NovelFS.NovelIO</div>
<div class="tip" id="fs3">type ExampleClass =<br />&#160;&#160;member Command : unit -&gt; unit<br />&#160;&#160;member Query : x:int -&gt; int<br /><br />Full name: Oopintro.ExampleClass</div>
<div class="tip" id="fs4">val this : ExampleClass</div>
<div class="tip" id="fs5">member ExampleClass.Command : unit -&gt; unit<br /><br />Full name: Oopintro.ExampleClass.Command<br /><em><br /><br />&#160;Performs the side effect of writing text to the screen</em></div>
<div class="tip" id="fs6">val printfn : format:Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.printfn</div>
<div class="tip" id="fs7">member ExampleClass.Query : x:int -&gt; int<br /><br />Full name: Oopintro.ExampleClass.Query<br /><em><br /><br />&#160;Pure function that raises x to the power of 3</em></div>
<div class="tip" id="fs8">val x : int</div>
<div class="tip" id="fs9">val pown : x:&#39;T -&gt; n:int -&gt; &#39;T (requires member get_One and member ( * ) and member ( / ))<br /><br />Full name: Microsoft.FSharp.Core.Operators.pown</div>
<div class="tip" id="fs10">val cube : x:int -&gt; int<br /><br />Full name: Oopintro.cube</div>
<div class="tip" id="fs11">namespace NovelFS.NovelIO.BinaryParser</div>
<div class="tip" id="fs12">val readIntFromFile : file:Filename -&gt; IO&lt;int option&gt;<br /><br />Full name: Oopintro.readIntFromFile</div>
<div class="tip" id="fs13">val file : Filename</div>
<div class="tip" id="fs14">val io : IO.IOBuilder<br /><br />Full name: NovelFS.NovelIO.IOBuilders.io</div>
<div class="tip" id="fs15">val bytes : byte []</div>
<div class="tip" id="fs16">module File<br /><br />from NovelFS.NovelIO</div>
<div class="tip" id="fs17">val readAllBytes : filename:Filename -&gt; IO&lt;byte []&gt;<br /><br />Full name: NovelFS.NovelIO.File.readAllBytes</div>
<div class="tip" id="fs18">Multiple items<br />module BinaryParser<br /><br />from NovelFS.NovelIO.BinaryParser<br /><br />--------------------<br />namespace NovelFS.NovelIO.BinaryParser<br /><br />--------------------<br />type BinaryParser&lt;&#39;s,&#39;a&gt; = private | RunState of (&#39;s -&gt; &#39;a * &#39;s)<br /><br />Full name: NovelFS.NovelIO.BinaryParser.BinaryParser&lt;_,_&gt;</div>
<div class="tip" id="fs19">val run : array:byte array -&gt; x:BinaryParser&lt;BinaryParserState,&#39;a&gt; -&gt; BinaryParseResult&lt;&#39;a&gt;<br /><br />Full name: NovelFS.NovelIO.BinaryParser.BinaryParser.run</div>
<div class="tip" id="fs20">val parseInt32 : BinaryParser&lt;BinaryParserState,int&gt;<br /><br />Full name: NovelFS.NovelIO.BinaryParser.BinaryParser.parseInt32</div>
<div class="tip" id="fs21">union case BinaryParseResult.ParseSuccess: &#39;a -&gt; BinaryParseResult&lt;&#39;a&gt;</div>
<div class="tip" id="fs22">val flt : int</div>
<div class="tip" id="fs23">union case Option.Some: Value: &#39;T -&gt; Option&lt;&#39;T&gt;</div>
<div class="tip" id="fs24">union case Option.None: Option&lt;&#39;T&gt;</div>

        </div>
        <div class="span3">
          <img src="/NovelIO/img/logo.png" alt="F# Project" style="width:150px;margin:10px" />  
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">NovelIO</li>
            <li><a href="/NovelIO/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="http://nuget.org/packages/NovelIO">Get Library via NuGet</a></li>
            <li><a href="http://github.com/TheInnerLight/NovelIO">Source Code on GitHub</a></li>
            <li><a href="/NovelIO/license.html">License</a></li>
            <li><a href="/NovelIO/release-notes.html">Release Notes</a></li>
            
            <li class="nav-header">Getting started</li>
            <li><a href="/NovelIO/oopintro.html">Introduction from an OOP Perspective</a></li>

            <li class="nav-header">Documentation</li>
            <li><a href="/NovelIO/reference/index.html">API Reference</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/TheInnerLight/NovelIO"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
