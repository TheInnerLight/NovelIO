<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Introduction from an Object-Oriented Perspective
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="F# Functional IO Library"/>
    <meta name="author" content="Phil Curzon"/>

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link type="text/css" rel="stylesheet" href="/NovelIO/content/style.css" />
    <script type="text/javascript" src="/NovelIO/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="http://github.com/TheInnerLight/NovelIO">github page</a></li>
        </ul>
        <h3 class="muted"><a href="/NovelIO/index.html">NovelIO</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1><a name="Introduction-from-an-Object-Oriented-Perspective" class="anchor" href="#Introduction-from-an-Object-Oriented-Perspective">Introduction from an Object-Oriented Perspective</a></h1>
<p>For those coming from an OOP background, the purpose of purely functional I/O might not seem immediately apparent but in many cases, what would be regarded as "good practise" in the object oriented world is something we can simply have by construction using referentially transparent IO.</p>
<h2><a name="Dependency-Inversion" class="anchor" href="#Dependency-Inversion">Dependency Inversion</a></h2>
<p>In the OO world, you might design an interface to retrieve some resource.  One implementation might touch the file system and then mock implementation would return test data for unit testing purposes.</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs5', 5)" onmouseover="showTip(event, 'fs5', 5)" class="t">IResourceSupplier</span> <span class="o">=</span>
    <span class="k">abstract</span> <span class="k">member</span> <span onmouseout="hideTip(event, 'fs6', 6)" onmouseover="showTip(event, 'fs6', 6)" class="f">GetList</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs7', 7)" onmouseover="showTip(event, 'fs7', 7)" class="t">unit</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs8', 8)" onmouseover="showTip(event, 'fs8', 8)" class="t">int</span> <span onmouseout="hideTip(event, 'fs9', 9)" onmouseover="showTip(event, 'fs9', 9)" class="t">list</span>
</code></pre>
<p>You can then pass the <code>IResourceSupplier</code> implementation to its consumers.</p>
<p>Imagine we wished to add one to every number retrieved by our resource supplier so we decide to use a constructor injected dependency.</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs10', 10)" onmouseover="showTip(event, 'fs10', 10)" class="t">Adder</span>(<span onmouseout="hideTip(event, 'fs11', 11)" onmouseover="showTip(event, 'fs11', 11)" class="i">supplier</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs5', 12)" onmouseover="showTip(event, 'fs5', 12)" class="t">IResourceSupplier</span>) <span class="o">=</span>
    <span class="k">member</span> <span onmouseout="hideTip(event, 'fs12', 13)" onmouseover="showTip(event, 'fs12', 13)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 14)" onmouseover="showTip(event, 'fs13', 14)" class="i">AddOne</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs14', 15)" onmouseover="showTip(event, 'fs14', 15)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs15', 16)" onmouseover="showTip(event, 'fs15', 16)" class="f">map</span> ((<span class="o">+</span>) <span class="n">1</span>) (<span onmouseout="hideTip(event, 'fs11', 17)" onmouseover="showTip(event, 'fs11', 17)" class="i">supplier</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs16', 18)" onmouseover="showTip(event, 'fs16', 18)" class="f">GetList</span>())
</code></pre>
<p>This class is now pretty easy to test, we just use a custom <code>IResourceSupplier</code> implementation and we can test the logic that the <code>Adder</code> class performs in isolation of its dependency.</p>
<p>Of course, we've had to add quite a bit of boilerplate to actually get to this point.</p>
<p>Exactly the same results can be achieved in IO by lifting a pure function into IO.</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// this pure function works on a standard lists, its trivial to unit test</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs17', 19)" onmouseover="showTip(event, 'fs17', 19)" class="f">addOneToList</span> <span onmouseout="hideTip(event, 'fs18', 20)" onmouseover="showTip(event, 'fs18', 20)" class="i">lst</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs14', 21)" onmouseover="showTip(event, 'fs14', 21)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs15', 22)" onmouseover="showTip(event, 'fs15', 22)" class="f">map</span> ((<span class="o">+</span>) <span class="n">1</span>) <span onmouseout="hideTip(event, 'fs18', 23)" onmouseover="showTip(event, 'fs18', 23)" class="i">lst</span> 

<span class="c">// this function is just the above function made to operate on lists in IO using map.</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs19', 24)" onmouseover="showTip(event, 'fs19', 24)" class="f">addOneToIOList</span> <span onmouseout="hideTip(event, 'fs20', 25)" onmouseover="showTip(event, 'fs20', 25)" class="i">lstIO</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 26)" onmouseover="showTip(event, 'fs3', 26)" class="t">IO</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs21', 27)" onmouseover="showTip(event, 'fs21', 27)" class="f">map</span> (<span onmouseout="hideTip(event, 'fs17', 28)" onmouseover="showTip(event, 'fs17', 28)" class="f">addOneToList</span>) <span onmouseout="hideTip(event, 'fs20', 29)" onmouseover="showTip(event, 'fs20', 29)" class="i">lstIO</span> 
</code></pre>
<p><code>IO.map</code> can take any function of the form <code>'a -&gt; 'b</code> and return an <code>IO&lt;'a&gt; -&gt; IO&lt;'b&gt;</code>, allowing our previously pure function to easily operate within IO.</p>
<p>We have gained the same testability advantage as the OO dependency inversion example with less boilerplate required to actually realise it.</p>
<p>We can also see through the type system which function performs IO and which does not.  That's a massive win for both readability and maintenance!</p>
<h2><a name="Command-Query-Seperation" class="anchor" href="#Command-Query-Seperation">Command-Query Seperation</a></h2>
<p>Command-query seperation (CQS) is an imperative programming principle that says that each method should either be a Command or a Query.</p>
<ul>
<li><p>Commands perform side effects but return no data, in F# terms they return <code>unit</code>.</p></li>
<li>Queries return data to the caller, they must be referentially transparent (i.e. possess no side-effects).</li>
</ul>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs22', 30)" onmouseover="showTip(event, 'fs22', 30)" class="t">ExampleClass</span> <span class="o">=</span>
    <span class="c">/// Performs the side effect of writing text to the screen</span>
    <span class="k">member</span> <span onmouseout="hideTip(event, 'fs23', 31)" onmouseover="showTip(event, 'fs23', 31)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs24', 32)" onmouseover="showTip(event, 'fs24', 32)" class="f">Command</span>() <span class="o">=</span> <span onmouseout="hideTip(event, 'fs25', 33)" onmouseover="showTip(event, 'fs25', 33)" class="f">printfn</span> <span class="s">&quot;Hello World!&quot;</span>
    <span class="c">/// Pure function that raises x to the power of 3</span>
    <span class="k">member</span> <span onmouseout="hideTip(event, 'fs23', 34)" onmouseover="showTip(event, 'fs23', 34)" class="i">this</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs26', 35)" onmouseover="showTip(event, 'fs26', 35)" class="f">Query</span> <span onmouseout="hideTip(event, 'fs27', 36)" onmouseover="showTip(event, 'fs27', 36)" class="i">x</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs28', 37)" onmouseover="showTip(event, 'fs28', 37)" class="f">pown</span> <span onmouseout="hideTip(event, 'fs27', 38)" onmouseover="showTip(event, 'fs27', 38)" class="i">x</span> <span class="n">3</span> 
</code></pre>
<p>CSQ has a laudable objective, to make it easier to reason about the way code behaves.</p>
<p>Any time we see <code>unit</code> we know that an effect is happening and any time we see a value returned, we know we have no side-effects.  Unfortunately, this pattern forbids common patterns like <code>random.Next()</code> which are ubiquitous in OO language standard library APIs.</p>
<p>Now let's express these using NovelIO:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs29', 39)" onmouseover="showTip(event, 'fs29', 39)" class="i">exampleIO</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs30', 40)" onmouseover="showTip(event, 'fs30', 40)" class="t">Console</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs31', 41)" onmouseover="showTip(event, 'fs31', 41)" class="f">writeLine</span> <span class="s">&quot;Hello World!&quot;</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs32', 42)" onmouseover="showTip(event, 'fs32', 42)" class="f">query</span> <span onmouseout="hideTip(event, 'fs27', 43)" onmouseover="showTip(event, 'fs27', 43)" class="i">x</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs28', 44)" onmouseover="showTip(event, 'fs28', 44)" class="f">pown</span> <span onmouseout="hideTip(event, 'fs27', 45)" onmouseover="showTip(event, 'fs27', 45)" class="i">x</span> <span class="n">3</span>
</code></pre>
<p>This looks very much the same as what we had before, exampleCommand is now of type <code>IO&lt;unit&gt;</code> instead of <code>unit -&gt; unit</code>.  But now lets look at the random example that we couldn't solve neatly using CQS:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs33', 46)" onmouseover="showTip(event, 'fs33', 46)" class="i">randomIO</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs34', 47)" onmouseover="showTip(event, 'fs34', 47)" class="t">Random</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs35', 48)" onmouseover="showTip(event, 'fs35', 48)" class="i">nextIO</span>
</code></pre>
<p><code>randomIO</code> here has type <code>IO&lt;int&gt;</code>.  That provides a strong and clear distinction from the type of <code>query</code> which has type <code>int -&gt; int</code>.</p>
<p>You can therefore think of referentially transparent IO as a more powerful version of CQS.</p>

<div class="tip" id="fs1">namespace NovelFS</div>
<div class="tip" id="fs2">namespace NovelFS.NovelIO</div>
<div class="tip" id="fs3">Multiple items<br />module IO<br /><br />from NovelFS.NovelIO<br /><br />--------------------<br />type IO&lt;&#39;a&gt; =<br />&#160;&#160;private | Return of &#39;a<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;| SyncIO of (unit -&gt; IO&lt;&#39;a&gt;)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;| AsyncIO of Async&lt;IO&lt;&#39;a&gt;&gt;<br /><br />Full name: NovelFS.NovelIO.IO&lt;_&gt;</div>
<div class="tip" id="fs4">module Operators<br /><br />from NovelFS.NovelIO.IO</div>
<div class="tip" id="fs5">type IResourceSupplier =<br />&#160;&#160;interface<br />&#160;&#160;&#160;&#160;abstract member GetList : unit -&gt; int list<br />&#160;&#160;end<br /><br />Full name: Oopintro.IResourceSupplier</div>
<div class="tip" id="fs6">abstract member IResourceSupplier.GetList : unit -&gt; int list<br /><br />Full name: Oopintro.IResourceSupplier.GetList</div>
<div class="tip" id="fs7">type unit = Unit<br /><br />Full name: Microsoft.FSharp.Core.unit</div>
<div class="tip" id="fs8">Multiple items<br />val int : value:&#39;T -&gt; int (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.int<br /><br />--------------------<br />type int = int32<br /><br />Full name: Microsoft.FSharp.Core.int<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; = int<br /><br />Full name: Microsoft.FSharp.Core.int&lt;_&gt;</div>
<div class="tip" id="fs9">type &#39;T list = List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.list&lt;_&gt;</div>
<div class="tip" id="fs10">Multiple items<br />type Adder =<br />&#160;&#160;new : supplier:IResourceSupplier -&gt; Adder<br />&#160;&#160;member AddOne : int list<br /><br />Full name: Oopintro.Adder<br /><br />--------------------<br />new : supplier:IResourceSupplier -&gt; Adder</div>
<div class="tip" id="fs11">val supplier : IResourceSupplier</div>
<div class="tip" id="fs12">val this : Adder</div>
<div class="tip" id="fs13">member Adder.AddOne : int list<br /><br />Full name: Oopintro.Adder.AddOne</div>
<div class="tip" id="fs14">Multiple items<br />module List<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type List&lt;&#39;T&gt; =<br />&#160;&#160;| ( [] )<br />&#160;&#160;| ( :: ) of Head: &#39;T * Tail: &#39;T list<br />&#160;&#160;interface IEnumerable<br />&#160;&#160;interface IEnumerable&lt;&#39;T&gt;<br />&#160;&#160;member GetSlice : startIndex:int option * endIndex:int option -&gt; &#39;T list<br />&#160;&#160;member Head : &#39;T<br />&#160;&#160;member IsEmpty : bool<br />&#160;&#160;member Item : index:int -&gt; &#39;T with get<br />&#160;&#160;member Length : int<br />&#160;&#160;member Tail : &#39;T list<br />&#160;&#160;static member Cons : head:&#39;T * tail:&#39;T list -&gt; &#39;T list<br />&#160;&#160;static member Empty : &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List&lt;_&gt;</div>
<div class="tip" id="fs15">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; list:&#39;T list -&gt; &#39;U list<br /><br />Full name: Microsoft.FSharp.Collections.List.map</div>
<div class="tip" id="fs16">abstract member IResourceSupplier.GetList : unit -&gt; int list</div>
<div class="tip" id="fs17">val addOneToList : lst:int list -&gt; int list<br /><br />Full name: Oopintro.addOneToList</div>
<div class="tip" id="fs18">val lst : int list</div>
<div class="tip" id="fs19">val addOneToIOList : lstIO:IO&lt;int list&gt; -&gt; IO&lt;int list&gt;<br /><br />Full name: Oopintro.addOneToIOList</div>
<div class="tip" id="fs20">val lstIO : IO&lt;int list&gt;</div>
<div class="tip" id="fs21">val map : f:(&#39;a -&gt; &#39;b) -&gt; x:IO&lt;&#39;a&gt; -&gt; IO&lt;&#39;b&gt;<br /><br />Full name: NovelFS.NovelIO.IO.map</div>
<div class="tip" id="fs22">type ExampleClass =<br />&#160;&#160;member Command : unit -&gt; unit<br />&#160;&#160;member Query : x:int -&gt; int<br /><br />Full name: Oopintro.ExampleClass</div>
<div class="tip" id="fs23">val this : ExampleClass</div>
<div class="tip" id="fs24">member ExampleClass.Command : unit -&gt; unit<br /><br />Full name: Oopintro.ExampleClass.Command<br /><em><br /><br />&#160;Performs the side effect of writing text to the screen</em></div>
<div class="tip" id="fs25">val printfn : format:Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.printfn</div>
<div class="tip" id="fs26">member ExampleClass.Query : x:int -&gt; int<br /><br />Full name: Oopintro.ExampleClass.Query<br /><em><br /><br />&#160;Pure function that raises x to the power of 3</em></div>
<div class="tip" id="fs27">val x : int</div>
<div class="tip" id="fs28">val pown : x:&#39;T -&gt; n:int -&gt; &#39;T (requires member get_One and member ( * ) and member ( / ))<br /><br />Full name: Microsoft.FSharp.Core.Operators.pown</div>
<div class="tip" id="fs29">val exampleIO : IO&lt;unit&gt;<br /><br />Full name: Oopintro.exampleIO</div>
<div class="tip" id="fs30">module Console<br /><br />from NovelFS.NovelIO</div>
<div class="tip" id="fs31">val writeLine : str:string -&gt; IO&lt;unit&gt;<br /><br />Full name: NovelFS.NovelIO.Console.writeLine</div>
<div class="tip" id="fs32">val query : x:int -&gt; int<br /><br />Full name: Oopintro.query</div>
<div class="tip" id="fs33">val randomIO : IO&lt;int&gt;<br /><br />Full name: Oopintro.randomIO</div>
<div class="tip" id="fs34">module Random<br /><br />from NovelFS.NovelIO</div>
<div class="tip" id="fs35">val nextIO : IO&lt;int&gt;<br /><br />Full name: NovelFS.NovelIO.Random.nextIO</div>

        </div>
        <div class="span3">
          <img src="/NovelIO/img/logo.png" alt="F# Project" style="width:150px;margin:10px" />  
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">NovelIO</li>
            <li><a href="/NovelIO/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="http://nuget.org/packages/NovelIO">Get Library via NuGet</a></li>
            <li><a href="http://github.com/TheInnerLight/NovelIO">Source Code on GitHub</a></li>
            <li><a href="/NovelIO/license.html">License</a></li>
            <li><a href="/NovelIO/release-notes.html">Release Notes</a></li>
            
            <li class="nav-header">Getting started</li>
            <li><a href="/NovelIO/motivation.html">Motivation</a></li>
            <li><a href="/NovelIO/oopintro.html">From an OOP Perspective</a></li>
            <li><a href="/NovelIO/files.html">Working with Files</a></li>
            <li><a href="/NovelIO/pickler.html">Using the Pickler Combinator</a></li>
            <li><a href="/NovelIO/channels.html">Channels</a></li>
            <li class="nav-header">Documentation</li>
            <li><a href="/NovelIO/operators.html">Operator Reference</a></li>
            <li><a href="/NovelIO/reference/index.html">API Reference</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/TheInnerLight/NovelIO"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
