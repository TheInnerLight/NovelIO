<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Motivation
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="F# Functional IO Library"/>
    <meta name="author" content="Phil Curzon"/>

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link type="text/css" rel="stylesheet" href="/NovelIO/content/style.css" />
    <script type="text/javascript" src="/NovelIO/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="http://github.com/TheInnerLight/NovelIO">github page</a></li>
        </ul>
        <h3 class="muted"><a href="/NovelIO/index.html">NovelIO</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1><a name="Motivation" class="anchor" href="#Motivation">Motivation</a></h1>
<h2><a name="Referential-Transparency" class="anchor" href="#Referential-Transparency">Referential Transparency</a></h2>
<p>In functional programming, referential transparency is a very useful property, an expression which is referentially transparent can be replaced by its value without affecting the behaviour of the program.</p>
<p>Consider:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="i">x</span> <span class="o">=</span> <span class="n">2</span> <span class="o">*</span> <span class="n">2</span>
</code></pre>
<p>The value <code>x</code>, <code>4</code> and <code>2*2</code> are all completely interchangeable, any of these descriptions anywhere in our program are all equally valid and do not change its behaviour.</p>
<p>Now consider:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="i">rnd</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs5', 5)" onmouseover="showTip(event, 'fs5', 5)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs6', 6)" onmouseover="showTip(event, 'fs6', 6)" class="t">Random</span>()
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs7', 7)" onmouseover="showTip(event, 'fs7', 7)" class="i">y</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs4', 8)" onmouseover="showTip(event, 'fs4', 8)" class="i">rnd</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs8', 9)" onmouseover="showTip(event, 'fs8', 9)" class="f">Next</span>()
</code></pre>
<p>The value <code>y</code> does not have this property.  We cannot freely interchange <code>y</code> and <code>rnd.Next()</code> without changing the behaviour of the program, this is because <code>rnd.Next</code> is not referentially transparent.</p>
<p>Referential transparency, however, is a very useful property, all functions in mathematics are referentially transparent and this helps us to reason about the behaviours of equations.  In computer science, this is no different, referential transparency makes it easier to prove correctness and to avoid bugs (especially in concurrent and parallel code).</p>
<p>If we express this logic again using <code>IO</code>, we can restore referential transparency:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs9', 10)" onmouseover="showTip(event, 'fs9', 10)" class="i">yPure</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 11)" onmouseover="showTip(event, 'fs10', 11)" class="t">Random</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs11', 12)" onmouseover="showTip(event, 'fs11', 12)" class="i">nextIO</span>
</code></pre>
<p>Once again, we can freely replace <code>yPure</code> and <code>Random.nextIO</code> wherever they appear in our program.  They both have precisely the same meaning, namely: an action which, when run, gets the next number from the global random number generator.</p>
<p>As mentioned in the introduction, <code>IO.run</code> is the only non-referentially transparent function exposed by this library and, as such, should be used sparingly!</p>
<h2><a name="Side-effects-and-lazy-evaluation" class="anchor" href="#Side-effects-and-lazy-evaluation">Side-effects and lazy evaluation</a></h2>
<p>In general, writing code that combines side effects and lazy evaluation can be complex and error prone, the developer can often be left with little idea when effects will actually be triggered.</p>
<p>Consider a program that gets some keystrokes:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 13)" onmouseover="showTip(event, 'fs12', 13)" class="i">keys</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 14)" onmouseover="showTip(event, 'fs13', 14)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 15)" onmouseover="showTip(event, 'fs14', 15)" class="f">initInfinite</span> (<span class="k">fun</span> _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs5', 16)" onmouseover="showTip(event, 'fs5', 16)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs15', 17)" onmouseover="showTip(event, 'fs15', 17)" class="t">Console</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs16', 18)" onmouseover="showTip(event, 'fs16', 18)" class="f">ReadKey</span>())

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs17', 19)" onmouseover="showTip(event, 'fs17', 19)" class="i">untilEnter</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs12', 20)" onmouseover="showTip(event, 'fs12', 20)" class="i">keys</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs13', 21)" onmouseover="showTip(event, 'fs13', 21)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs18', 22)" onmouseover="showTip(event, 'fs18', 22)" class="f">takeWhile</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs19', 23)" onmouseover="showTip(event, 'fs19', 23)" class="i">ki</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs19', 24)" onmouseover="showTip(event, 'fs19', 24)" class="i">ki</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 25)" onmouseover="showTip(event, 'fs20', 25)" class="i">Key</span> <span class="o">&lt;&gt;</span> <span onmouseout="hideTip(event, 'fs5', 26)" onmouseover="showTip(event, 'fs5', 26)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs21', 27)" onmouseover="showTip(event, 'fs21', 27)" class="t">ConsoleKey</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs22', 28)" onmouseover="showTip(event, 'fs22', 28)" class="i">Enter</span>)

<span onmouseout="hideTip(event, 'fs23', 29)" onmouseover="showTip(event, 'fs23', 29)" class="f">printfn</span> <span class="s">&quot;Length: </span><span class="pf">%d</span><span class="s">&quot;</span> (<span onmouseout="hideTip(event, 'fs13', 30)" onmouseover="showTip(event, 'fs13', 30)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs24', 31)" onmouseover="showTip(event, 'fs24', 31)" class="f">length</span> <span onmouseout="hideTip(event, 'fs17', 32)" onmouseover="showTip(event, 'fs17', 32)" class="i">untilEnter</span>)

<span onmouseout="hideTip(event, 'fs17', 33)" onmouseover="showTip(event, 'fs17', 33)" class="i">untilEnter</span>
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs13', 34)" onmouseover="showTip(event, 'fs13', 34)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs25', 35)" onmouseover="showTip(event, 'fs25', 35)" class="f">map</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs19', 36)" onmouseover="showTip(event, 'fs19', 36)" class="i">ki</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs26', 37)" onmouseover="showTip(event, 'fs26', 37)" class="f">string</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs19', 38)" onmouseover="showTip(event, 'fs19', 38)" class="i">ki</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs27', 39)" onmouseover="showTip(event, 'fs27', 39)" class="i">KeyChar</span>)
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs28', 40)" onmouseover="showTip(event, 'fs28', 40)" class="t">String</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs29', 41)" onmouseover="showTip(event, 'fs29', 41)" class="f">concat</span> <span class="s">&quot;&quot;</span>
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs23', 42)" onmouseover="showTip(event, 'fs23', 42)" class="f">printfn</span> <span class="s">&quot;String: </span><span class="pf">%s</span><span class="s">&quot;</span>
</code></pre>
<p>At first glance, this program might appear to record key strokes until the user presses 'Enter', print the length and then print the result.  Of course, it does not.</p>
<p>In reality, this program counts key strokes until the user presses 'Enter' and prints this length, then it records key strokes again until the user presses 'Enter' and prints the result.</p>
<p>If we express this program using this library, the effects are clearly apparent:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs30', 43)" onmouseover="showTip(event, 'fs30', 43)" class="i">keysIO</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs31', 44)" onmouseover="showTip(event, 'fs31', 44)" class="t">Console</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs32', 45)" onmouseover="showTip(event, 'fs32', 45)" class="i">readKey</span> 
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs33', 46)" onmouseover="showTip(event, 'fs33', 46)" class="t">IO</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs34', 47)" onmouseover="showTip(event, 'fs34', 47)" class="t">Loops</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs35', 48)" onmouseover="showTip(event, 'fs35', 48)" class="f">unfoldWhileM</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs19', 49)" onmouseover="showTip(event, 'fs19', 49)" class="i">ki</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs19', 50)" onmouseover="showTip(event, 'fs19', 50)" class="i">ki</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 51)" onmouseover="showTip(event, 'fs20', 51)" class="i">Key</span> <span class="o">&lt;&gt;</span> <span onmouseout="hideTip(event, 'fs5', 52)" onmouseover="showTip(event, 'fs5', 52)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs21', 53)" onmouseover="showTip(event, 'fs21', 53)" class="t">ConsoleKey</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs22', 54)" onmouseover="showTip(event, 'fs22', 54)" class="i">Enter</span>)
</code></pre>
<p>We can then choose to perform the action twice (as before):</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs36', 55)" onmouseover="showTip(event, 'fs36', 55)" class="i">io</span> {
    <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs37', 56)" onmouseover="showTip(event, 'fs37', 56)" class="i">sequence1</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs30', 57)" onmouseover="showTip(event, 'fs30', 57)" class="i">keysIO</span>
    <span class="k">do!</span> <span onmouseout="hideTip(event, 'fs33', 58)" onmouseover="showTip(event, 'fs33', 58)" class="i">IO</span><span class="o">.</span><span class="i">putStrLn</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs38', 59)" onmouseover="showTip(event, 'fs38', 59)" class="f">sprintf</span> <span class="s">&quot;Length: </span><span class="pf">%d</span><span class="s">&quot;</span> (<span onmouseout="hideTip(event, 'fs13', 60)" onmouseover="showTip(event, 'fs13', 60)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs24', 61)" onmouseover="showTip(event, 'fs24', 61)" class="f">length</span> <span onmouseout="hideTip(event, 'fs37', 62)" onmouseover="showTip(event, 'fs37', 62)" class="i">sequence1</span>)
    <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs39', 63)" onmouseover="showTip(event, 'fs39', 63)" class="i">sequence2</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs30', 64)" onmouseover="showTip(event, 'fs30', 64)" class="i">keysIO</span>
    <span class="k">do!</span> <span onmouseout="hideTip(event, 'fs39', 65)" onmouseover="showTip(event, 'fs39', 65)" class="i">sequence2</span>
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs13', 66)" onmouseover="showTip(event, 'fs13', 66)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs25', 67)" onmouseover="showTip(event, 'fs25', 67)" class="f">map</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs19', 68)" onmouseover="showTip(event, 'fs19', 68)" class="i">ki</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs26', 69)" onmouseover="showTip(event, 'fs26', 69)" class="f">string</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs19', 70)" onmouseover="showTip(event, 'fs19', 70)" class="i">ki</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs27', 71)" onmouseover="showTip(event, 'fs27', 71)" class="i">KeyChar</span>)
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs28', 72)" onmouseover="showTip(event, 'fs28', 72)" class="t">String</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs29', 73)" onmouseover="showTip(event, 'fs29', 73)" class="f">concat</span> <span class="s">&quot;&quot;</span>
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs38', 74)" onmouseover="showTip(event, 'fs38', 74)" class="f">sprintf</span> <span class="s">&quot;String: </span><span class="pf">%s</span><span class="s">&quot;</span>
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs33', 75)" onmouseover="showTip(event, 'fs33', 75)" class="i">IO</span><span class="o">.</span><span class="i">putStrLn</span>
} <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs33', 76)" onmouseover="showTip(event, 'fs33', 76)" class="t">IO</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs40', 77)" onmouseover="showTip(event, 'fs40', 77)" class="f">run</span>
</code></pre>
<p>Or execute the action only once:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs36', 78)" onmouseover="showTip(event, 'fs36', 78)" class="i">io</span> {
    <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs41', 79)" onmouseover="showTip(event, 'fs41', 79)" class="i">sequence</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs30', 80)" onmouseover="showTip(event, 'fs30', 80)" class="i">keysIO</span>
    <span class="k">do!</span> <span onmouseout="hideTip(event, 'fs33', 81)" onmouseover="showTip(event, 'fs33', 81)" class="i">IO</span><span class="o">.</span><span class="i">putStrLn</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs38', 82)" onmouseover="showTip(event, 'fs38', 82)" class="f">sprintf</span> <span class="s">&quot;Length: </span><span class="pf">%d</span><span class="s">&quot;</span> (<span onmouseout="hideTip(event, 'fs13', 83)" onmouseover="showTip(event, 'fs13', 83)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs24', 84)" onmouseover="showTip(event, 'fs24', 84)" class="f">length</span> <span onmouseout="hideTip(event, 'fs41', 85)" onmouseover="showTip(event, 'fs41', 85)" class="i">sequence</span>)
    <span class="k">do!</span> <span onmouseout="hideTip(event, 'fs41', 86)" onmouseover="showTip(event, 'fs41', 86)" class="i">sequence</span>
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs13', 87)" onmouseover="showTip(event, 'fs13', 87)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs25', 88)" onmouseover="showTip(event, 'fs25', 88)" class="f">map</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs19', 89)" onmouseover="showTip(event, 'fs19', 89)" class="i">ki</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs26', 90)" onmouseover="showTip(event, 'fs26', 90)" class="f">string</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs19', 91)" onmouseover="showTip(event, 'fs19', 91)" class="i">ki</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs27', 92)" onmouseover="showTip(event, 'fs27', 92)" class="i">KeyChar</span>)
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs28', 93)" onmouseover="showTip(event, 'fs28', 93)" class="t">String</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs29', 94)" onmouseover="showTip(event, 'fs29', 94)" class="f">concat</span> <span class="s">&quot;&quot;</span>
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs38', 95)" onmouseover="showTip(event, 'fs38', 95)" class="f">sprintf</span> <span class="s">&quot;String: </span><span class="pf">%s</span><span class="s">&quot;</span>
        <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs33', 96)" onmouseover="showTip(event, 'fs33', 96)" class="i">IO</span><span class="o">.</span><span class="i">putStrLn</span>
} <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs33', 97)" onmouseover="showTip(event, 'fs33', 97)" class="t">IO</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs40', 98)" onmouseover="showTip(event, 'fs40', 98)" class="f">run</span>
</code></pre>
<p>In both cases, we have successfully made our decision explicit.</p>
<h2><a name="Random-numbers" class="anchor" href="#Random-numbers">Random numbers</a></h2>
<p>Sequences of random numbers are another area where side-effects can be particularly devastating while being produced by code that looks innocuous.</p>
<p>Consider this code:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs42', 99)" onmouseover="showTip(event, 'fs42', 99)" class="i">randomSeq</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 100)" onmouseover="showTip(event, 'fs13', 100)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs43', 101)" onmouseover="showTip(event, 'fs43', 101)" class="f">init</span> <span class="n">4</span> (<span class="k">fun</span> _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs4', 102)" onmouseover="showTip(event, 'fs4', 102)" class="i">rnd</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs8', 103)" onmouseover="showTip(event, 'fs8', 103)" class="f">Next</span>())
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs44', 104)" onmouseover="showTip(event, 'fs44', 104)" class="i">sortedSeq</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 105)" onmouseover="showTip(event, 'fs13', 105)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 106)" onmouseover="showTip(event, 'fs45', 106)" class="f">sort</span> <span onmouseout="hideTip(event, 'fs42', 107)" onmouseover="showTip(event, 'fs42', 107)" class="i">randomSeq</span>

<span onmouseout="hideTip(event, 'fs23', 108)" onmouseover="showTip(event, 'fs23', 108)" class="f">printfn</span> <span class="s">&quot;Sorted: </span><span class="pf">%A</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs44', 109)" onmouseover="showTip(event, 'fs44', 109)" class="i">sortedSeq</span>
<span onmouseout="hideTip(event, 'fs23', 110)" onmouseover="showTip(event, 'fs23', 110)" class="f">printfn</span> <span class="s">&quot;Random: </span><span class="pf">%A</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs42', 111)" onmouseover="showTip(event, 'fs42', 111)" class="i">randomSeq</span>
</code></pre>
<p>Let's at the results of an example run of this program:</p>
<blockquote>
<p>Sorted: seq [42595606; 980900814; 1328311795; 1497661916]
Random: seq [308839936; 1514073672; 36105878; 741971034]</p>
</blockquote>
<p>While this program appears to generate one sequence, sort it, then print the sorted and unsorted result - that isn't what it actually does.  What it actually does is effectively define two random sequence generators, one of which is sorted and the other is not.</p>
<p>Each time we enumerate <code>randomSeq</code> or <code>sortedSeq</code>, the original side effect of getting random numbers is produced again and again!</p>
<p>Here is the original program we desired to write using NovelIO.</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs36', 112)" onmouseover="showTip(event, 'fs36', 112)" class="i">io</span> {
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs46', 113)" onmouseover="showTip(event, 'fs46', 113)" class="i">randomSeqIO</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs33', 114)" onmouseover="showTip(event, 'fs33', 114)" class="t">IO</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs47', 115)" onmouseover="showTip(event, 'fs47', 115)" class="f">replicateM</span> (<span onmouseout="hideTip(event, 'fs10', 116)" onmouseover="showTip(event, 'fs10', 116)" class="t">Random</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs11', 117)" onmouseover="showTip(event, 'fs11', 117)" class="i">nextIO</span>) <span class="n">4</span>
    <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs48', 118)" onmouseover="showTip(event, 'fs48', 118)" class="i">randomSeq</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs46', 119)" onmouseover="showTip(event, 'fs46', 119)" class="i">randomSeqIO</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs49', 120)" onmouseover="showTip(event, 'fs49', 120)" class="i">sortedSeq</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 121)" onmouseover="showTip(event, 'fs13', 121)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 122)" onmouseover="showTip(event, 'fs45', 122)" class="f">sort</span> <span onmouseout="hideTip(event, 'fs48', 123)" onmouseover="showTip(event, 'fs48', 123)" class="i">randomSeq</span>
    <span class="k">do!</span> <span onmouseout="hideTip(event, 'fs33', 124)" onmouseover="showTip(event, 'fs33', 124)" class="i">IO</span><span class="o">.</span><span class="i">putStrLn</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs38', 125)" onmouseover="showTip(event, 'fs38', 125)" class="f">sprintf</span> <span class="s">&quot;Sorted: </span><span class="pf">%A</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs49', 126)" onmouseover="showTip(event, 'fs49', 126)" class="i">sortedSeq</span>
    <span class="k">do!</span> <span onmouseout="hideTip(event, 'fs33', 127)" onmouseover="showTip(event, 'fs33', 127)" class="i">IO</span><span class="o">.</span><span class="i">putStrLn</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs38', 128)" onmouseover="showTip(event, 'fs38', 128)" class="f">sprintf</span> <span class="s">&quot;Random: </span><span class="pf">%A</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs48', 129)" onmouseover="showTip(event, 'fs48', 129)" class="i">randomSeq</span>
    } <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs33', 130)" onmouseover="showTip(event, 'fs33', 130)" class="t">IO</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs40', 131)" onmouseover="showTip(event, 'fs40', 131)" class="f">run</span>
</code></pre>
<blockquote>
<p>Sorted: seq [75121301; 124930198; 609009994; 824551074]
Random: [824551074; 609009994; 75121301; 124930198]</p>
</blockquote>
<p>Notice that now, both sequences contain the same values.  The generation of actual random numbers is triggered by the line <code>let! randomSeq = randomSeqIO</code> which makes the effect completely explicit.</p>
<p>In order to get our program to behave like the original one that uses a sequence with side effects, we have to explicitly ask for a second set of evaluated effects.</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs36', 132)" onmouseover="showTip(event, 'fs36', 132)" class="i">io</span> {
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs46', 133)" onmouseover="showTip(event, 'fs46', 133)" class="i">randomSeqIO</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs33', 134)" onmouseover="showTip(event, 'fs33', 134)" class="t">IO</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs47', 135)" onmouseover="showTip(event, 'fs47', 135)" class="f">replicateM</span> (<span onmouseout="hideTip(event, 'fs10', 136)" onmouseover="showTip(event, 'fs10', 136)" class="t">Random</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs11', 137)" onmouseover="showTip(event, 'fs11', 137)" class="i">nextIO</span>) <span class="n">4</span>
    <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs48', 138)" onmouseover="showTip(event, 'fs48', 138)" class="i">randomSeq</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs46', 139)" onmouseover="showTip(event, 'fs46', 139)" class="i">randomSeqIO</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs49', 140)" onmouseover="showTip(event, 'fs49', 140)" class="i">sortedSeq</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 141)" onmouseover="showTip(event, 'fs13', 141)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 142)" onmouseover="showTip(event, 'fs45', 142)" class="f">sort</span> <span onmouseout="hideTip(event, 'fs48', 143)" onmouseover="showTip(event, 'fs48', 143)" class="i">randomSeq</span> <span class="c">// sort the first set</span>
    <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs50', 144)" onmouseover="showTip(event, 'fs50', 144)" class="i">randomSeq2</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs46', 145)" onmouseover="showTip(event, 'fs46', 145)" class="i">randomSeqIO</span> <span class="c">// evaluate the effects of randomSeqIO again</span>
    <span class="k">do!</span> <span onmouseout="hideTip(event, 'fs33', 146)" onmouseover="showTip(event, 'fs33', 146)" class="i">IO</span><span class="o">.</span><span class="i">putStrLn</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs38', 147)" onmouseover="showTip(event, 'fs38', 147)" class="f">sprintf</span> <span class="s">&quot;Sorted: </span><span class="pf">%A</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs49', 148)" onmouseover="showTip(event, 'fs49', 148)" class="i">sortedSeq</span>
    <span class="k">do!</span> <span onmouseout="hideTip(event, 'fs33', 149)" onmouseover="showTip(event, 'fs33', 149)" class="i">IO</span><span class="o">.</span><span class="i">putStrLn</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs38', 150)" onmouseover="showTip(event, 'fs38', 150)" class="f">sprintf</span> <span class="s">&quot;Random: </span><span class="pf">%A</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs50', 151)" onmouseover="showTip(event, 'fs50', 151)" class="i">randomSeq2</span>
    } <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs33', 152)" onmouseover="showTip(event, 'fs33', 152)" class="t">IO</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs40', 153)" onmouseover="showTip(event, 'fs40', 153)" class="f">run</span>
</code></pre>
<blockquote>
<p>Sorted: seq [79034179; 1625119183; 1651455963; 1775638512]
Random: [1801985798; 963004958; 1819358047; 292397249]</p>
</blockquote>
<p>So, using this approach we can easily describe either behaviour while still keeping the intent clear and explicit.</p>

<div class="tip" id="fs1">namespace NovelFS</div>
<div class="tip" id="fs2">namespace NovelFS.NovelIO</div>
<div class="tip" id="fs3">val x : int<br /><br />Full name: Motivation.x</div>
<div class="tip" id="fs4">val rnd : System.Random<br /><br />Full name: Motivation.rnd</div>
<div class="tip" id="fs5">namespace System</div>
<div class="tip" id="fs6">Multiple items<br />type Random =<br />&#160;&#160;new : unit -&gt; Random + 1 overload<br />&#160;&#160;member Next : unit -&gt; int + 2 overloads<br />&#160;&#160;member NextBytes : buffer:byte[] -&gt; unit<br />&#160;&#160;member NextDouble : unit -&gt; float<br /><br />Full name: System.Random<br /><br />--------------------<br />System.Random() : unit<br />System.Random(Seed: int) : unit</div>
<div class="tip" id="fs7">val y : int<br /><br />Full name: Motivation.y</div>
<div class="tip" id="fs8">System.Random.Next() : int<br />System.Random.Next(maxValue: int) : int<br />System.Random.Next(minValue: int, maxValue: int) : int</div>
<div class="tip" id="fs9">val yPure : IO&lt;int&gt;<br /><br />Full name: Motivation.yPure</div>
<div class="tip" id="fs10">module Random<br /><br />from NovelFS.NovelIO</div>
<div class="tip" id="fs11">val nextIO : IO&lt;int&gt;<br /><br />Full name: NovelFS.NovelIO.Random.nextIO</div>
<div class="tip" id="fs12">val keys : seq&lt;System.ConsoleKeyInfo&gt;<br /><br />Full name: Motivation.keys</div>
<div class="tip" id="fs13">module Seq<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs14">val initInfinite : initializer:(int -&gt; &#39;T) -&gt; seq&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.initInfinite</div>
<div class="tip" id="fs15">type Console =<br />&#160;&#160;static member BackgroundColor : ConsoleColor with get, set<br />&#160;&#160;static member Beep : unit -&gt; unit + 1 overload<br />&#160;&#160;static member BufferHeight : int with get, set<br />&#160;&#160;static member BufferWidth : int with get, set<br />&#160;&#160;static member CapsLock : bool<br />&#160;&#160;static member Clear : unit -&gt; unit<br />&#160;&#160;static member CursorLeft : int with get, set<br />&#160;&#160;static member CursorSize : int with get, set<br />&#160;&#160;static member CursorTop : int with get, set<br />&#160;&#160;static member CursorVisible : bool with get, set<br />&#160;&#160;...<br /><br />Full name: System.Console</div>
<div class="tip" id="fs16">System.Console.ReadKey() : System.ConsoleKeyInfo<br />System.Console.ReadKey(intercept: bool) : System.ConsoleKeyInfo</div>
<div class="tip" id="fs17">val untilEnter : seq&lt;System.ConsoleKeyInfo&gt;<br /><br />Full name: Motivation.untilEnter</div>
<div class="tip" id="fs18">val takeWhile : predicate:(&#39;T -&gt; bool) -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.takeWhile</div>
<div class="tip" id="fs19">val ki : System.ConsoleKeyInfo</div>
<div class="tip" id="fs20">property System.ConsoleKeyInfo.Key: System.ConsoleKey</div>
<div class="tip" id="fs21">type ConsoleKey =<br />&#160;&#160;| Backspace = 8<br />&#160;&#160;| Tab = 9<br />&#160;&#160;| Clear = 12<br />&#160;&#160;| Enter = 13<br />&#160;&#160;| Pause = 19<br />&#160;&#160;| Escape = 27<br />&#160;&#160;| Spacebar = 32<br />&#160;&#160;| PageUp = 33<br />&#160;&#160;| PageDown = 34<br />&#160;&#160;| End = 35<br />&#160;&#160;...<br /><br />Full name: System.ConsoleKey</div>
<div class="tip" id="fs22">field System.ConsoleKey.Enter = 13</div>
<div class="tip" id="fs23">val printfn : format:Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.printfn</div>
<div class="tip" id="fs24">val length : source:seq&lt;&#39;T&gt; -&gt; int<br /><br />Full name: Microsoft.FSharp.Collections.Seq.length</div>
<div class="tip" id="fs25">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;U&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.map</div>
<div class="tip" id="fs26">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.Operators.string<br /><br />--------------------<br />type string = System.String<br /><br />Full name: Microsoft.FSharp.Core.string</div>
<div class="tip" id="fs27">property System.ConsoleKeyInfo.KeyChar: char</div>
<div class="tip" id="fs28">module String<br /><br />from Microsoft.FSharp.Core</div>
<div class="tip" id="fs29">val concat : sep:string -&gt; strings:seq&lt;string&gt; -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.String.concat</div>
<div class="tip" id="fs30">val keysIO : IO&lt;System.ConsoleKeyInfo list&gt;<br /><br />Full name: Motivation.keysIO</div>
<div class="tip" id="fs31">module Console<br /><br />from NovelFS.NovelIO</div>
<div class="tip" id="fs32">val readKey : IO&lt;System.ConsoleKeyInfo&gt;<br /><br />Full name: NovelFS.NovelIO.Console.readKey</div>
<div class="tip" id="fs33">Multiple items<br />module IO<br /><br />from NovelFS.NovelIO<br /><br />--------------------<br />type IO&lt;&#39;a&gt; =<br />&#160;&#160;private | Return of &#39;a<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;| SyncIO of (unit -&gt; IO&lt;&#39;a&gt;)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;| AsyncIO of Async&lt;IO&lt;&#39;a&gt;&gt;<br /><br />Full name: NovelFS.NovelIO.IO&lt;_&gt;</div>
<div class="tip" id="fs34">module Loops<br /><br />from NovelFS.NovelIO.IO</div>
<div class="tip" id="fs35">val unfoldWhileM : p:(&#39;a -&gt; bool) -&gt; f:IO&lt;&#39;a&gt; -&gt; IO&lt;&#39;a list&gt;<br /><br />Full name: NovelFS.NovelIO.IO.Loops.unfoldWhileM</div>
<div class="tip" id="fs36">val io : IO.IOBuilder<br /><br />Full name: NovelFS.NovelIO.IOBuilders.io</div>
<div class="tip" id="fs37">val sequence1 : System.ConsoleKeyInfo list</div>
<div class="tip" id="fs38">val sprintf : format:Printf.StringFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.sprintf</div>
<div class="tip" id="fs39">val sequence2 : System.ConsoleKeyInfo list</div>
<div class="tip" id="fs40">val run : io:IO&lt;&#39;a&gt; -&gt; &#39;a<br /><br />Full name: NovelFS.NovelIO.IO.run</div>
<div class="tip" id="fs41">val sequence : System.ConsoleKeyInfo list</div>
<div class="tip" id="fs42">val randomSeq : seq&lt;int&gt;<br /><br />Full name: Motivation.randomSeq</div>
<div class="tip" id="fs43">val init : count:int -&gt; initializer:(int -&gt; &#39;T) -&gt; seq&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.init</div>
<div class="tip" id="fs44">val sortedSeq : seq&lt;int&gt;<br /><br />Full name: Motivation.sortedSeq</div>
<div class="tip" id="fs45">val sort : source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;T&gt; (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Seq.sort</div>
<div class="tip" id="fs46">val randomSeqIO : IO&lt;int list&gt;</div>
<div class="tip" id="fs47">val replicateM : mFunc:IO&lt;&#39;a&gt; -&gt; n:int -&gt; IO&lt;&#39;a list&gt;<br /><br />Full name: NovelFS.NovelIO.IO.replicateM</div>
<div class="tip" id="fs48">val randomSeq : int list</div>
<div class="tip" id="fs49">val sortedSeq : seq&lt;int&gt;</div>
<div class="tip" id="fs50">val randomSeq2 : int list</div>

        </div>
        <div class="span3">
          <img src="/NovelIO/img/logo.png" alt="F# Project" style="width:150px;margin:10px" />  
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">NovelIO</li>
            <li><a href="/NovelIO/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="http://nuget.org/packages/NovelIO">Get Library via NuGet</a></li>
            <li><a href="http://github.com/TheInnerLight/NovelIO">Source Code on GitHub</a></li>
            <li><a href="/NovelIO/license.html">License</a></li>
            <li><a href="/NovelIO/release-notes.html">Release Notes</a></li>
            
            <li class="nav-header">Getting started</li>
            <li><a href="/NovelIO/motivation.html">Motivation</a></li>
            <li><a href="/NovelIO/oopintro.html">From an OOP Perspective</a></li>
            <li><a href="/NovelIO/files.html">Working with Files</a></li>
            <li><a href="/NovelIO/pickler.html">Using the Pickler Combinator</a></li>
            <li><a href="/NovelIO/channels.html">Channels</a></li>
            <li class="nav-header">Documentation</li>
            <li><a href="/NovelIO/operators.html">Operator Reference</a></li>
            <li><a href="/NovelIO/reference/index.html">API Reference</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/TheInnerLight/NovelIO"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
