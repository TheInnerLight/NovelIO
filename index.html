<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Introduction
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="F# Functional IO Library"/>
    <meta name="author" content="Phil Curzon"/>

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link type="text/css" rel="stylesheet" href="/NovelIO/content/style.css" />
    <script type="text/javascript" src="/NovelIO/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="http://github.com/TheInnerLight/NovelIO">github page</a></li>
        </ul>
        <h3 class="muted"><a href="/NovelIO/index.html">NovelIO</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1><a name="Introduction" class="anchor" href="#Introduction">Introduction</a></h1>
<p>NovelIO is a library designed to bring the explicit safety and robustness that comes with describing effects in the type system to the .NET framework.
The result is a purely functional approach to describing I/O operations whereby functions do not perform side-effects but rather construct values that represent a sequence of effects that can later be executed.</p>
<p>The primary goal of this library is to help developers to design more maintainable and testable code by making it easier to reason about when I/O operations occur.</p>
<p>Much like in Haskell, we introduce the <code>IO&lt;'a&gt;</code> type which represents some action that, when performed successfully, returns some result <code>'a.</code>  Here are some examples:</p>
<ul>
<li>An IO action that prints the string "Hello World" to the screen has type <code>IO&lt;unit&gt;</code>.</li>
<li>An IO action that gets a line of text from the Console has type <code>IO&lt;string&gt;</code>.</li>
<li>An IO action that opens a TCP connection has type <code>IO&lt;TCPConnectedSocket&gt;</code>.</li>
<li>An IO action that launches some missiles has type <code>IO&lt;unit&gt;</code></li>
</ul>
<p>The IO action can equally represent an arbitrary sequence of actions:</p>
<ul>
<li>An IO action that requests a Name, then that person's Date of Birth from a service might have type <code>IO&lt;string, DateTime&gt;</code></li>
<li>An IO action that returns a potentially unknown number of lines from a file might have type <code>IO&lt;string list&gt;</code></li>
</ul>
<p>Indeed an entire web server could be represented as a single value of type <code>IO&lt;unit&gt;</code>!</p>
<p>The key distinction between this representation of effects and the side-effects found in imperative programming is that values of type <code>IO&lt;'a&gt;</code> do not represent the result of some side effect, they actually represent the action/effect that can be <code>run</code> to produce a particular result.</p>
<p>The idea of actions being values rather than functions is extremely powerful, it allows us to begin with a small set of orthogonal primitive actions that can be passed around and composed, using combinator functions, to build up to advanced behaviours quickly, easily and safely!</p>
<h2><a name="Running-IO-Actions" class="anchor" href="#Running-IO-Actions">Running IO Actions</a></h2>
<p><code>IO&lt;'a&gt;</code> Actions can be <code>run</code> using the <code>IO.run</code> function.  This results in all of the side-effects being evaluated and the generation of a result of type <code>'a</code>.</p>
<p>These values can then be re-used and run again to evaluate the side-effects once more.</p>
<p>Consider a standard .NET impure IO example:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs6', 6)" onmouseover="showTip(event, 'fs6', 6)" class="i">exmpl</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs7', 7)" onmouseover="showTip(event, 'fs7', 7)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs8', 8)" onmouseover="showTip(event, 'fs8', 8)" class="t">Console</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs9', 9)" onmouseover="showTip(event, 'fs9', 9)" class="f">ReadLine</span>()
<span onmouseout="hideTip(event, 'fs10', 10)" onmouseover="showTip(event, 'fs10', 10)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%s</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs6', 11)" onmouseover="showTip(event, 'fs6', 11)" class="i">exmpl</span>
<span onmouseout="hideTip(event, 'fs10', 12)" onmouseover="showTip(event, 'fs10', 12)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%s</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs6', 13)" onmouseover="showTip(event, 'fs6', 13)" class="i">exmpl</span>
</code></pre>
<p>And a NovelIO example:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs11', 14)" onmouseover="showTip(event, 'fs11', 14)" class="i">exmpl2</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs12', 15)" onmouseover="showTip(event, 'fs12', 15)" class="i">io</span> {<span class="k">return!</span> <span onmouseout="hideTip(event, 'fs13', 16)" onmouseover="showTip(event, 'fs13', 16)" class="t">Console</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 17)" onmouseover="showTip(event, 'fs14', 17)" class="i">readLine</span>}
<span onmouseout="hideTip(event, 'fs10', 18)" onmouseover="showTip(event, 'fs10', 18)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%s</span><span class="s">&quot;</span> (<span onmouseout="hideTip(event, 'fs4', 19)" onmouseover="showTip(event, 'fs4', 19)" class="t">IO</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs15', 20)" onmouseover="showTip(event, 'fs15', 20)" class="f">run</span> <span onmouseout="hideTip(event, 'fs11', 21)" onmouseover="showTip(event, 'fs11', 21)" class="i">exmpl2</span>)
<span onmouseout="hideTip(event, 'fs10', 22)" onmouseover="showTip(event, 'fs10', 22)" class="f">printfn</span> <span class="s">&quot;</span><span class="pf">%s</span><span class="s">&quot;</span> (<span onmouseout="hideTip(event, 'fs4', 23)" onmouseover="showTip(event, 'fs4', 23)" class="t">IO</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs15', 24)" onmouseover="showTip(event, 'fs15', 24)" class="f">run</span> <span onmouseout="hideTip(event, 'fs11', 25)" onmouseover="showTip(event, 'fs11', 25)" class="i">exmpl2</span>)
</code></pre>
<p>Take careful note of the different behaviour.</p>
<p>In the first example <code>exmpl</code> represents the result of the user input from the console, we perform that side effect only once and print the same value to the console twice.</p>
<p>In the second example <code>exmpl2</code> represents the action of reading user input from the console and running it gives us the result.  Hence, in this case, the user is prompted for input twice and potentially different results are printed.</p>
<p><code>IO.run</code> is the only non-referentially transparent function exposed to the user in this library and is equivalent to <code>unsafePerformIO</code> in Haskell.  Since F# is fundamentally still an impure language, it is up to the developer how often they wish to make use of it.</p>
<p>It is possible (albeit certainly not recommended!) to call <code>IO.run</code> on every small block of IO code.  It is also possible to call <code>IO.run</code> only once, in the main function, for an entire program: it is then possible to visualise the running of a program as the only effectful part of otherwise pure, referentially transparent code.</p>
<h2><a name="Compositionality" class="anchor" href="#Compositionality">Compositionality</a></h2>
<p>One of the key attractions of this representation of IO is that we can design IO actions and then compose them together to build new and more complex IO actions.</p>
<p>Let's assume for a moment that we wish to read two lines from the console and return them as a tuple.  That can be achieved as follows:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs16', 26)" onmouseover="showTip(event, 'fs16', 26)" class="i">readTwoLines</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs12', 27)" onmouseover="showTip(event, 'fs12', 27)" class="i">io</span> {
        <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs17', 28)" onmouseover="showTip(event, 'fs17', 28)" class="i">line1</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 29)" onmouseover="showTip(event, 'fs13', 29)" class="t">Console</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 30)" onmouseover="showTip(event, 'fs14', 30)" class="i">readLine</span>
        <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs18', 31)" onmouseover="showTip(event, 'fs18', 31)" class="i">line2</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 32)" onmouseover="showTip(event, 'fs13', 32)" class="t">Console</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 33)" onmouseover="showTip(event, 'fs14', 33)" class="i">readLine</span>
        <span class="k">return</span> <span onmouseout="hideTip(event, 'fs17', 34)" onmouseover="showTip(event, 'fs17', 34)" class="i">line1</span>, <span onmouseout="hideTip(event, 'fs18', 35)" onmouseover="showTip(event, 'fs18', 35)" class="i">line2</span>
    }
</code></pre>
<p><code>let!</code> is used to request the result of an IO action when the enclosing action is run.</p>
<p>Notice that we have taken two primitive IO actions of type <code>IO&lt;string&gt;</code> and used them to construct a new IO action of type <code>IO&lt;string*string&gt;</code></p>
<p>Likewise, if we wished to write two lines to the console, we could construct an action like this:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs19', 36)" onmouseover="showTip(event, 'fs19', 36)" class="f">writeTwoLines</span> <span onmouseout="hideTip(event, 'fs17', 37)" onmouseover="showTip(event, 'fs17', 37)" class="i">line1</span> <span onmouseout="hideTip(event, 'fs18', 38)" onmouseover="showTip(event, 'fs18', 38)" class="i">line2</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs12', 39)" onmouseover="showTip(event, 'fs12', 39)" class="i">io</span> {
        <span class="k">do!</span> <span onmouseout="hideTip(event, 'fs13', 40)" onmouseover="showTip(event, 'fs13', 40)" class="t">Console</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 41)" onmouseover="showTip(event, 'fs20', 41)" class="f">writeLine</span> <span onmouseout="hideTip(event, 'fs17', 42)" onmouseover="showTip(event, 'fs17', 42)" class="i">line1</span>
        <span class="k">do!</span> <span onmouseout="hideTip(event, 'fs13', 43)" onmouseover="showTip(event, 'fs13', 43)" class="t">Console</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 44)" onmouseover="showTip(event, 'fs20', 44)" class="f">writeLine</span> <span onmouseout="hideTip(event, 'fs18', 45)" onmouseover="showTip(event, 'fs18', 45)" class="i">line2</span>
    }
</code></pre>
<p><code>do!</code> is used to evaluate an IO action of type <code>unit</code> when the enclosing action is run.</p>
<p>In this case, we have taken two IO actions of type <code>IO&lt;unit&gt;</code> and created a new action of type <code>IO&lt;unit&gt;</code>.</p>
<h2><a name="Loops" class="anchor" href="#Loops">Loops</a></h2>
<p>A common task during I/O operations is to perform some action until a condition is met.  There are a variety of combinators to help with this sort of task:</p>
<p>Let's assume we wish to print the numbers 1..10 to the console.  One way of doing this would be:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs21', 46)" onmouseover="showTip(event, 'fs21', 46)" class="i">print1To10</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs4', 47)" onmouseover="showTip(event, 'fs4', 47)" class="t">IO</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs22', 48)" onmouseover="showTip(event, 'fs22', 48)" class="f">iterM</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs23', 49)" onmouseover="showTip(event, 'fs23', 49)" class="i">i</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs13', 50)" onmouseover="showTip(event, 'fs13', 50)" class="t">Console</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 51)" onmouseover="showTip(event, 'fs20', 51)" class="f">writeLine</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs24', 52)" onmouseover="showTip(event, 'fs24', 52)" class="f">string</span> <span onmouseout="hideTip(event, 'fs23', 53)" onmouseover="showTip(event, 'fs23', 53)" class="i">i</span>) [<span class="n">1..</span><span class="n">10</span>] <span class="c">// The lambda here could be replaced by (Console.writeLine &lt;&lt; string)</span>
</code></pre>
<p>The <code>iterM</code> function is used to define <code>for</code> loops in the IO monad.  The below code is completely equivalent to the above:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs25', 54)" onmouseover="showTip(event, 'fs25', 54)" class="i">print1To10For</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs12', 55)" onmouseover="showTip(event, 'fs12', 55)" class="i">io</span> {
        <span class="k">for</span> <span onmouseout="hideTip(event, 'fs23', 56)" onmouseover="showTip(event, 'fs23', 56)" class="i">i</span> <span class="k">in</span> [<span class="n">1..</span><span class="n">10</span>] <span class="k">do</span>
            <span class="k">do!</span> <span onmouseout="hideTip(event, 'fs13', 57)" onmouseover="showTip(event, 'fs13', 57)" class="t">Console</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 58)" onmouseover="showTip(event, 'fs20', 58)" class="f">writeLine</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs24', 59)" onmouseover="showTip(event, 'fs24', 59)" class="f">string</span> <span onmouseout="hideTip(event, 'fs23', 60)" onmouseover="showTip(event, 'fs23', 60)" class="i">i</span>
    }
</code></pre>
<p>A common task in File IO is performing a loop to retrieve lines from a file until you reach the end of the file.</p>
<p>In this case, we can't use a simple <code>for</code> loop as we did previously because the logic for checking the loop end condition is also side effecting!  Fortunately, we have another function for this occassion:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs26', 61)" onmouseover="showTip(event, 'fs26', 61)" class="f">readFileUntilEnd</span> <span onmouseout="hideTip(event, 'fs27', 62)" onmouseover="showTip(event, 'fs27', 62)" class="i">path</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs28', 63)" onmouseover="showTip(event, 'fs28', 63)" class="t">File</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs29', 64)" onmouseover="showTip(event, 'fs29', 64)" class="f">withTextChannel</span> <span onmouseout="hideTip(event, 'fs28', 65)" onmouseover="showTip(event, 'fs28', 65)" class="t">File</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs30', 66)" onmouseover="showTip(event, 'fs30', 66)" class="t">Open</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs31', 67)" onmouseover="showTip(event, 'fs31', 67)" class="i">defaultRead</span> <span onmouseout="hideTip(event, 'fs27', 68)" onmouseover="showTip(event, 'fs27', 68)" class="i">path</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs32', 69)" onmouseover="showTip(event, 'fs32', 69)" class="i">channel</span> <span class="k">-&gt;</span>
        <span onmouseout="hideTip(event, 'fs4', 70)" onmouseover="showTip(event, 'fs4', 70)" class="t">IO</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs33', 71)" onmouseover="showTip(event, 'fs33', 71)" class="t">Loops</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs34', 72)" onmouseover="showTip(event, 'fs34', 72)" class="f">untilM</span> (<span onmouseout="hideTip(event, 'fs35', 73)" onmouseover="showTip(event, 'fs35', 73)" class="t">TextChannel</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs36', 74)" onmouseover="showTip(event, 'fs36', 74)" class="f">isEOF</span> <span onmouseout="hideTip(event, 'fs32', 75)" onmouseover="showTip(event, 'fs32', 75)" class="i">channel</span>) (<span onmouseout="hideTip(event, 'fs35', 76)" onmouseover="showTip(event, 'fs35', 76)" class="t">TextChannel</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs37', 77)" onmouseover="showTip(event, 'fs37', 77)" class="f">getLine</span> <span onmouseout="hideTip(event, 'fs32', 78)" onmouseover="showTip(event, 'fs32', 78)" class="i">channel</span>))
</code></pre>
<p>The <code>withTextChannel</code> encapsulates the lifetime of the text channel, accepting as an argument a function where we make use of the channel.</p>
<p>In this function, we use the <code>untilM</code> combinator, its first argument is an <code>IO&lt;bool&gt;</code> condition and its second is an action to perform while the condition is <code>false</code>.</p>
<p>It runs a <code>list</code> of all the results we generated from the action argument while the condition was <code>false</code>.</p>
<h2><a name="Parallel-and-Asychronous-IO" class="anchor" href="#Parallel-and-Asychronous-IO">Parallel and Asychronous IO</a></h2>
<h3><a name="Forking-IO-actions" class="anchor" href="#Forking-IO-actions">Forking IO actions</a></h3>
<p>If you wish to perform some IO on another thread then <code>forkIO</code> is the function of choice.  It simply performs the work on the .NET thread pool and doesn't ever return a result.</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs12', 79)" onmouseover="showTip(event, 'fs12', 79)" class="i">io</span> {
    <span class="k">do!</span> <span onmouseout="hideTip(event, 'fs4', 80)" onmouseover="showTip(event, 'fs4', 80)" class="t">IO</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs38', 81)" onmouseover="showTip(event, 'fs38', 81)" class="f">forkIO</span> <span onmouseout="hideTip(event, 'fs3', 82)" onmouseover="showTip(event, 'fs3', 82)" class="i">someAction</span>
}
</code></pre>
<p>If you wished to perform a task and then retrieve the results later, you would need to use <code>forkTask</code> and <code>awaitTask</code>.</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs12', 83)" onmouseover="showTip(event, 'fs12', 83)" class="i">io</span> {
    <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs39', 84)" onmouseover="showTip(event, 'fs39', 84)" class="i">task</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs4', 85)" onmouseover="showTip(event, 'fs4', 85)" class="t">IO</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs40', 86)" onmouseover="showTip(event, 'fs40', 86)" class="f">forkTask</span> <span class="o">&lt;|</span> <span onmouseout="hideTip(event, 'fs4', 87)" onmouseover="showTip(event, 'fs4', 87)" class="t">IO</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs41', 88)" onmouseover="showTip(event, 'fs41', 88)" class="f">replicateM</span> <span onmouseout="hideTip(event, 'fs42', 89)" onmouseover="showTip(event, 'fs42', 89)" class="t">Random</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs43', 90)" onmouseover="showTip(event, 'fs43', 90)" class="i">nextIO</span> <span class="n">100</span> <span class="c">// create a task that generates some random numbers on the thread pool</span>
    <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs44', 91)" onmouseover="showTip(event, 'fs44', 91)" class="i">results</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs4', 92)" onmouseover="showTip(event, 'fs4', 92)" class="t">IO</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 93)" onmouseover="showTip(event, 'fs45', 93)" class="f">awaitTask</span> <span onmouseout="hideTip(event, 'fs39', 94)" onmouseover="showTip(event, 'fs39', 94)" class="i">task</span> <span class="c">// await the completion of the task (await Task waits asychronously, it will not block threads)</span>
    <span class="k">return</span> <span onmouseout="hideTip(event, 'fs44', 95)" onmouseover="showTip(event, 'fs44', 95)" class="i">results</span>
}
</code></pre>
<h3><a name="Parallel-actions" class="anchor" href="#Parallel-actions">Parallel actions</a></h3>
<p>Entire lists of IO actions can be performed in parallel using the functions in the <code>IO.Parallel</code> module.  This gives us very explicit, fine-grained, control over what actions should take place in parallel.</p>
<p>In order to execute items in parallel, we can simply build a list of the IO actions we wish to perform and use the <code>IO.Parallel.sequence</code> combinator.</p>
<blockquote>
<p><strong>Aside:</strong> You may notice that <code>IO.Parallel.sequence</code> has exactly the same type signature as the <code>IO.sequence</code> function.
These two functions are fundamentally very similar, the only difference is that <code>IO.sequence</code> joins a list of actions sequentially and <code>IO.Parallel.sequence</code> joins a list of actions in parallel.</p>
</blockquote>
<p>For example:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs12', 96)" onmouseover="showTip(event, 'fs12', 96)" class="i">io</span> {
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs46', 97)" onmouseover="showTip(event, 'fs46', 97)" class="i">fName</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs28', 98)" onmouseover="showTip(event, 'fs28', 98)" class="t">File</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs47', 99)" onmouseover="showTip(event, 'fs47', 99)" class="t">Path</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs48', 100)" onmouseover="showTip(event, 'fs48', 100)" class="f">fromValid</span> <span class="s">&quot;file.txt&quot;</span>
    <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs32', 101)" onmouseover="showTip(event, 'fs32', 101)" class="i">channel</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs28', 102)" onmouseover="showTip(event, 'fs28', 102)" class="t">File</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs49', 103)" onmouseover="showTip(event, 'fs49', 103)" class="f">openTextChannel</span> <span onmouseout="hideTip(event, 'fs28', 104)" onmouseover="showTip(event, 'fs28', 104)" class="t">File</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs30', 105)" onmouseover="showTip(event, 'fs30', 105)" class="t">Open</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs31', 106)" onmouseover="showTip(event, 'fs31', 106)" class="i">defaultRead</span> <span onmouseout="hideTip(event, 'fs46', 107)" onmouseover="showTip(event, 'fs46', 107)" class="i">fName</span>
    <span class="k">return</span> <span onmouseout="hideTip(event, 'fs4', 108)" onmouseover="showTip(event, 'fs4', 108)" class="t">IO</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs50', 109)" onmouseover="showTip(event, 'fs50', 109)" class="t">Parallel</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs51', 110)" onmouseover="showTip(event, 'fs51', 110)" class="f">sequence</span> [<span onmouseout="hideTip(event, 'fs13', 111)" onmouseover="showTip(event, 'fs13', 111)" class="t">Console</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 112)" onmouseover="showTip(event, 'fs14', 112)" class="i">readLine</span>; <span onmouseout="hideTip(event, 'fs35', 113)" onmouseover="showTip(event, 'fs35', 113)" class="t">TextChannel</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs37', 114)" onmouseover="showTip(event, 'fs37', 114)" class="f">getLine</span> <span onmouseout="hideTip(event, 'fs32', 115)" onmouseover="showTip(event, 'fs32', 115)" class="i">channel</span>]
} <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs4', 116)" onmouseover="showTip(event, 'fs4', 116)" class="t">IO</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs15', 117)" onmouseover="showTip(event, 'fs15', 117)" class="f">run</span>
</code></pre>
<p>This describes a program that gets a line from the console and a line from a specified file in parallel and returns them in a list of strings.</p>
<h2><a name="Bringing-impure-functions-into-IO" class="anchor" href="#Bringing-impure-functions-into-IO">Bringing impure functions into IO</a></h2>
<p>It's very likely that the set of functions included in this library will not cover every possible IO action we might ever wish to perform.  In this case, we can use the <code>IO.fromEffectful</code> to take a non-referentially transparent function and bring it within IO.</p>
<p>Here is an example of creating a simple IO action that increments a reference variable.</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs52', 118)" onmouseover="showTip(event, 'fs52', 118)" class="v">num</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs53', 119)" onmouseover="showTip(event, 'fs53', 119)" class="f">ref</span> <span class="n">0</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs54', 120)" onmouseover="showTip(event, 'fs54', 120)" class="i">incrIO</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs4', 121)" onmouseover="showTip(event, 'fs4', 121)" class="t">IO</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs55', 122)" onmouseover="showTip(event, 'fs55', 122)" class="f">fromEffectful</span> (<span class="k">fun</span> _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs56', 123)" onmouseover="showTip(event, 'fs56', 123)" class="f">incr</span> <span onmouseout="hideTip(event, 'fs52', 124)" onmouseover="showTip(event, 'fs52', 124)" class="v">num</span>)
</code></pre>
<p>This allows us to construct arbitrary programs entirely within IO.</p>

<div class="tip" id="fs1">namespace NovelFS</div>
<div class="tip" id="fs2">namespace NovelFS.NovelIO</div>
<div class="tip" id="fs3">val someAction : IO&lt;unit&gt;<br /><br />Full name: Index.someAction</div>
<div class="tip" id="fs4">Multiple items<br />module IO<br /><br />from NovelFS.NovelIO<br /><br />--------------------<br />type IO&lt;&#39;a&gt; =<br />&#160;&#160;private | Return of &#39;a<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;| SyncIO of (unit -&gt; IO&lt;&#39;a&gt;)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;| AsyncIO of Async&lt;IO&lt;&#39;a&gt;&gt;<br /><br />Full name: NovelFS.NovelIO.IO&lt;_&gt;</div>
<div class="tip" id="fs5">val return&#39; : x:&#39;a -&gt; IO&lt;&#39;a&gt;<br /><br />Full name: NovelFS.NovelIO.IO.return&#39;</div>
<div class="tip" id="fs6">val exmpl : string<br /><br />Full name: Index.exmpl</div>
<div class="tip" id="fs7">namespace System</div>
<div class="tip" id="fs8">type Console =<br />&#160;&#160;static member BackgroundColor : ConsoleColor with get, set<br />&#160;&#160;static member Beep : unit -&gt; unit + 1 overload<br />&#160;&#160;static member BufferHeight : int with get, set<br />&#160;&#160;static member BufferWidth : int with get, set<br />&#160;&#160;static member CapsLock : bool<br />&#160;&#160;static member Clear : unit -&gt; unit<br />&#160;&#160;static member CursorLeft : int with get, set<br />&#160;&#160;static member CursorSize : int with get, set<br />&#160;&#160;static member CursorTop : int with get, set<br />&#160;&#160;static member CursorVisible : bool with get, set<br />&#160;&#160;...<br /><br />Full name: System.Console</div>
<div class="tip" id="fs9">System.Console.ReadLine() : string</div>
<div class="tip" id="fs10">val printfn : format:Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.printfn</div>
<div class="tip" id="fs11">val exmpl2 : IO&lt;string&gt;<br /><br />Full name: Index.exmpl2</div>
<div class="tip" id="fs12">val io : IO.IOBuilder<br /><br />Full name: NovelFS.NovelIO.IOBuilders.io</div>
<div class="tip" id="fs13">module Console<br /><br />from NovelFS.NovelIO</div>
<div class="tip" id="fs14">val readLine : IO&lt;string&gt;<br /><br />Full name: NovelFS.NovelIO.Console.readLine</div>
<div class="tip" id="fs15">val run : io:IO&lt;&#39;a&gt; -&gt; &#39;a<br /><br />Full name: NovelFS.NovelIO.IO.run</div>
<div class="tip" id="fs16">val readTwoLines : IO&lt;string * string&gt;<br /><br />Full name: Index.readTwoLines</div>
<div class="tip" id="fs17">val line1 : string</div>
<div class="tip" id="fs18">val line2 : string</div>
<div class="tip" id="fs19">val writeTwoLines : line1:string -&gt; line2:string -&gt; IO&lt;unit&gt;<br /><br />Full name: Index.writeTwoLines</div>
<div class="tip" id="fs20">val writeLine : str:string -&gt; IO&lt;unit&gt;<br /><br />Full name: NovelFS.NovelIO.Console.writeLine</div>
<div class="tip" id="fs21">val print1To10 : IO&lt;unit&gt;<br /><br />Full name: Index.print1To10</div>
<div class="tip" id="fs22">val iterM : mFunc:(&#39;a -&gt; IO&lt;&#39;b&gt;) -&gt; sequ:seq&lt;&#39;a&gt; -&gt; IO&lt;unit&gt;<br /><br />Full name: NovelFS.NovelIO.IO.iterM</div>
<div class="tip" id="fs23">val i : int</div>
<div class="tip" id="fs24">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.Operators.string<br /><br />--------------------<br />type string = System.String<br /><br />Full name: Microsoft.FSharp.Core.string</div>
<div class="tip" id="fs25">val print1To10For : IO&lt;unit&gt;<br /><br />Full name: Index.print1To10For</div>
<div class="tip" id="fs26">val readFileUntilEnd : path:FilePath -&gt; IO&lt;string list&gt;<br /><br />Full name: Index.readFileUntilEnd</div>
<div class="tip" id="fs27">val path : FilePath</div>
<div class="tip" id="fs28">module File<br /><br />from NovelFS.NovelIO</div>
<div class="tip" id="fs29">val withTextChannel : options:FileOpenOptions -&gt; fName:FilePath -&gt; fChannel:(TChannel -&gt; IO&lt;&#39;a&gt;) -&gt; IO&lt;&#39;a&gt;<br /><br />Full name: NovelFS.NovelIO.File.withTextChannel</div>
<div class="tip" id="fs30">module Open<br /><br />from NovelFS.NovelIO.File</div>
<div class="tip" id="fs31">val defaultRead : FileOpenOptions<br /><br />Full name: NovelFS.NovelIO.File.Open.defaultRead</div>
<div class="tip" id="fs32">val channel : TChannel</div>
<div class="tip" id="fs33">module Loops<br /><br />from NovelFS.NovelIO.IO</div>
<div class="tip" id="fs34">val untilM : pAct:IO&lt;bool&gt; -&gt; f:IO&lt;&#39;a&gt; -&gt; IO&lt;&#39;a list&gt;<br /><br />Full name: NovelFS.NovelIO.IO.Loops.untilM</div>
<div class="tip" id="fs35">module TextChannel<br /><br />from NovelFS.NovelIO</div>
<div class="tip" id="fs36">val isEOF : channel:TChannel -&gt; IO&lt;bool&gt;<br /><br />Full name: NovelFS.NovelIO.TextChannel.isEOF</div>
<div class="tip" id="fs37">val getLine : channel:TChannel -&gt; IO&lt;string&gt;<br /><br />Full name: NovelFS.NovelIO.TextChannel.getLine</div>
<div class="tip" id="fs38">val forkIO : io:IO&lt;&#39;a&gt; -&gt; IO&lt;unit&gt;<br /><br />Full name: NovelFS.NovelIO.IO.forkIO</div>
<div class="tip" id="fs39">val task : System.Threading.Tasks.Task&lt;int list&gt;</div>
<div class="tip" id="fs40">val forkTask : io:IO&lt;&#39;a&gt; -&gt; IO&lt;System.Threading.Tasks.Task&lt;&#39;a&gt;&gt;<br /><br />Full name: NovelFS.NovelIO.IO.forkTask</div>
<div class="tip" id="fs41">val replicateM : mFunc:IO&lt;&#39;a&gt; -&gt; n:int -&gt; IO&lt;&#39;a list&gt;<br /><br />Full name: NovelFS.NovelIO.IO.replicateM</div>
<div class="tip" id="fs42">module Random<br /><br />from NovelFS.NovelIO</div>
<div class="tip" id="fs43">val nextIO : IO&lt;int&gt;<br /><br />Full name: NovelFS.NovelIO.Random.nextIO</div>
<div class="tip" id="fs44">val results : int list</div>
<div class="tip" id="fs45">val awaitTask : task:System.Threading.Tasks.Task&lt;&#39;a&gt; -&gt; IO&lt;&#39;a&gt;<br /><br />Full name: NovelFS.NovelIO.IO.awaitTask</div>
<div class="tip" id="fs46">val fName : FilePath</div>
<div class="tip" id="fs47">module Path<br /><br />from NovelFS.NovelIO.File</div>
<div class="tip" id="fs48">val fromValid : path:string -&gt; FilePath<br /><br />Full name: NovelFS.NovelIO.File.Path.fromValid</div>
<div class="tip" id="fs49">val openTextChannel : options:FileOpenOptions -&gt; fName:FilePath -&gt; IO&lt;TChannel&gt;<br /><br />Full name: NovelFS.NovelIO.File.openTextChannel</div>
<div class="tip" id="fs50">module Parallel<br /><br />from NovelFS.NovelIO.IO</div>
<div class="tip" id="fs51">val sequence : ios:IO&lt;&#39;a&gt; list -&gt; IO&lt;&#39;a list&gt;<br /><br />Full name: NovelFS.NovelIO.IO.Parallel.sequence</div>
<div class="tip" id="fs52">val num : int ref<br /><br />Full name: Index.num</div>
<div class="tip" id="fs53">Multiple items<br />val ref : value:&#39;T -&gt; &#39;T ref<br /><br />Full name: Microsoft.FSharp.Core.Operators.ref<br /><br />--------------------<br />type &#39;T ref = Ref&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Core.ref&lt;_&gt;</div>
<div class="tip" id="fs54">val incrIO : IO&lt;unit&gt;<br /><br />Full name: Index.incrIO</div>
<div class="tip" id="fs55">val fromEffectful : f:(unit -&gt; &#39;a) -&gt; IO&lt;&#39;a&gt;<br /><br />Full name: NovelFS.NovelIO.IO.fromEffectful</div>
<div class="tip" id="fs56">val incr : cell:int ref -&gt; unit<br /><br />Full name: Microsoft.FSharp.Core.Operators.incr</div>

        </div>
        <div class="span3">
          <img src="/NovelIO/img/logo.png" alt="F# Project" style="width:150px;margin:10px" />  
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">NovelIO</li>
            <li><a href="/NovelIO/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="http://nuget.org/packages/NovelIO">Get Library via NuGet</a></li>
            <li><a href="http://github.com/TheInnerLight/NovelIO">Source Code on GitHub</a></li>
            <li><a href="/NovelIO/license.html">License</a></li>
            <li><a href="/NovelIO/release-notes.html">Release Notes</a></li>
            
            <li class="nav-header">Getting started</li>
            <li><a href="/NovelIO/motivation.html">Motivation</a></li>
            <li><a href="/NovelIO/oopintro.html">From an OOP Perspective</a></li>
            <li><a href="/NovelIO/files.html">Working with Files</a></li>
            <li><a href="/NovelIO/pickler.html">Using the Pickler Combinator</a></li>
            <li><a href="/NovelIO/channels.html">Channels</a></li>
            <li class="nav-header">Documentation</li>
            <li><a href="/NovelIO/operators.html">Operator Reference</a></li>
            <li><a href="/NovelIO/reference/index.html">API Reference</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/TheInnerLight/NovelIO"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
